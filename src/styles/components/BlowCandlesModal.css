/* =========================================
   VARIABLES & THEMES
   ========================================= */
:root {
  --modal-bg: #2d3748;
  --modal-text: #ffffff;
  --accent-color: #38b2ac;
}

/* Flavor Palettes */
.cake-container.chocolate {
  --cake-base: #3e2723;
  --cake-shadow: #281a17;
  --icing-bg: #5d4037;
  --icing-highlight: #795548;
}

.cake-container.strawberry {
  --cake-base: #c2185b;
  --cake-shadow: #880e4f;
  --icing-bg: #f8bbd0;
  --icing-highlight: #fce4ec;
}

.cake-container.matcha {
  --cake-base: #33691e;
  --cake-shadow: #1b5e20;
  --icing-bg: #c5e1a5;
  --icing-highlight: #dcedc8;
}

.cake-container.cookies {
  --cake-base: #212121;
  --cake-shadow: #000000;
  --icing-bg: #eeeeee;
  --icing-highlight: #ffffff;
  --texture: radial-gradient(#424242 15%, transparent 16%) 0 0,
             radial-gradient(#424242 15%, transparent 16%) 8px 8px;
}

/* =========================================
   OVERLAY & MODAL LAYOUT
   ========================================= */
.candle-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(8px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  padding: 20px;
}

.candle-modal {
  background: var(--modal-bg);
  color: var(--modal-text);
  width: 100%;
  max-width: 800px;
  /* Responsive Height: adapts to content but keeps structure */
  min-height: 500px; 
  border-radius: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-between;
  padding: 24px;
  position: relative;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
  overflow: hidden;
}

/* =========================================
   HEADER & FLAVOR UI
   ========================================= */
.modal-header {
  width: 100%;
  text-align: center;
  position: relative;
  margin-bottom: 10px;
}

.candle-title {
  font-size: 1.8rem;
  font-weight: 700;
  margin: 0;
  letter-spacing: 1px;
}

.close-btn {
  position: absolute;
  top: -10px;
  right: -10px;
  background: rgba(255,255,255,0.1);
  border: none;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  color: white;
  font-size: 18px;
  cursor: pointer;
  transition: 0.2s;
}

.close-btn:hover {
  background: rgba(255,255,255,0.2);
}

.flavor-selector {
  display: flex;
  gap: 12px;
  margin-bottom: 10px;
  z-index: 50; /* Above cake */
}

.flavor-btn {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.2);
  cursor: pointer;
  transition: transform 0.2s, border-color 0.2s;
}

.flavor-btn.active {
  transform: scale(1.2);
  border-color: #fff;
  box-shadow: 0 0 10px rgba(255,255,255,0.5);
}

/* Flavor Button Colors */
.flavor-btn.chocolate { background: #5d4037; }
.flavor-btn.strawberry { background: #f8bbd0; }
.flavor-btn.matcha { background: #c5e1a5; }
.flavor-btn.cookies { 
  background: #eeeeee; 
  background-image: radial-gradient(#424242 20%, transparent 20%);
  background-size: 6px 6px;
}

/* =========================================
   3D CAKE ENGINE (SCALING)
   ========================================= */
.cake-container {
  width: 100%;
  height: 300px; /* Allocated space for cake */
  display: flex;
  justify-content: center;
  align-items: center;
  perspective: 1000px;
  /* Prevent touch scrolling on the cake area to allow tilting */
  touch-action: none; 
}

/* The cake uses fixed pixels for internal 3D math, 
   but we scale the whole element based on screen size */
.cake {
  position: relative;
  width: 300px;
  height: 200px;
  transform-style: preserve-3d;
  cursor: grab;
}

.cake:active {
  cursor: grabbing;
}

/* --- RESPONSIVE SCALING --- */
@media (min-width: 1024px) { .cake { transform: scale(1.2); } }
@media (max-width: 768px) { .cake { transform: scale(0.9); } }
@media (max-width: 480px) { .cake { transform: scale(0.65); } }

/* Plate */
.plate {
  position: absolute;
  width: 380px;
  height: 280px;
  background: #e2e8f0;
  border-radius: 50%;
  top: 100px;
  left: 50%;
  transform: translateX(-50%) translateZ(-20px);
  box-shadow: 
    0 4px 0 #cbd5e0,
    0 10px 40px rgba(0,0,0,0.4);
}

/* Layers */
.layer {
  position: absolute;
  width: 320px;
  height: 240px;
  left: 50%;
  transform: translateX(-50%);
  border-radius: 50%;
  background: var(--cake-base);
  box-shadow: 
    0 4px 0 var(--cake-shadow),
    0 8px 0 var(--cake-shadow),
    0 12px 0 var(--cake-shadow),
    0 16px 0 var(--cake-shadow);
}

.layer-bottom { top: 60px; transform: translateX(-50%) translateZ(0px); }
.layer-middle { top: 30px; transform: translateX(-50%) translateZ(15px); }
.layer-top    { top: 0px;  transform: translateX(-50%) translateZ(30px); }

/* Icing */
.icing {
  position: absolute;
  width: 310px;
  height: 230px;
  left: 50%;
  top: 2px;
  transform: translateX(-50%) translateZ(32px);
  background: var(--icing-bg);
  background-color: var(--icing-bg);
  background-image: var(--texture, none);
  background-size: 10px 10px;
  border-radius: 50%;
}

.icing::after {
  content: "";
  position: absolute;
  inset: 10px;
  border-radius: 50%;
  background: rgba(255,255,255,0.15);
}

/* Drips */
.drip {
  position: absolute;
  background: var(--icing-bg);
  border-bottom-left-radius: 20px;
  border-bottom-right-radius: 20px;
  transform: translateZ(32px);
  z-index: 10;
}

/* .drip1 { top: 210px; left: 60px; width: 40px; height: 80px; transform: translateZ(35px) rotateY(10deg); }
.drip2 { top: 130px; left: 140px; width: 30px; height: 60px; transform: translateZ(45px); }
.drip3 { top: 110px; left: 220px; width: 50px; height: 90px; transform: translateZ(35px) rotateY(-10deg); } */

/* =========================================
   CANDLES & FLAMES
   ========================================= */
.candles-group {
  position: absolute;
  top: 60px; /* Center visually on top of cake */
  width: 0;
  height: 0;
  transform-style: preserve-3d;
  transform: translateZ(35px);
}

.candle {
  position: absolute;
  width: 8px;
  height: 35px;
  background: linear-gradient(to right, #e53e3e, #c53030);
  border-radius: 2px;
  transform-origin: bottom center;
  transform: rotateX(-10deg); /* Counter-tilt to stand straight */
  box-shadow: -1px 1px 2px rgba(0,0,0,0.3);
}

.candle::before { /* Wick */
  content: "";
  position: absolute;
  top: -4px;
  left: 3px;
  width: 2px;
  height: 4px;
  background: #333;
}

/* Flame Animation */
.flame {
  position: absolute;
  top: -20px;
  left: 50%;
  width: 10px;
  height: 20px;
  background: radial-gradient(ellipse at bottom, #ffff00 0%, #ff9800 60%, transparent 100%);
  border-radius: 50% 50% 20% 20%;
  transform: translateX(-50%);
  animation: flicker 0.15s infinite alternate;
  filter: drop-shadow(0 0 4px #ff9800);
}

@keyframes flicker {
  0% { transform: translateX(-50%) scale(1); opacity: 0.9; }
  100% { transform: translateX(-50%) scale(1.1) skewX(2deg); opacity: 1; }
}

/* Smoke Animation */
.smoke {
  position: absolute;
  top: -15px;
  left: 50%;
  width: 6px;
  height: 6px;
  background: rgba(200, 200, 200, 0.6);
  border-radius: 50%;
  animation: rise 1.5s ease-out forwards;
}

@keyframes rise {
  0% { transform: translateX(-50%) scale(1); opacity: 0.8; }
  100% { transform: translateX(-50%) translateY(-40px) scale(3); opacity: 0; }
}

/* =========================================
   FOOTER & UI CONTROLS
   ========================================= */
.modal-footer {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 80px;
  position: relative;
}

.action-btn {
  background: var(--accent-color);
  border: none;
  padding: 14px 32px;
  border-radius: 50px;
  color: white;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 4px 15px rgba(56, 178, 172, 0.4);
  transition: transform 0.2s, box-shadow 0.2s;
  z-index: 100;
}

.action-btn:active {
  transform: scale(0.95);
}

.action-btn.listening {
  background: #e53e3e;
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(229, 62, 62, 0.7); }
  70% { box-shadow: 0 0 0 15px rgba(229, 62, 62, 0); }
  100% { box-shadow: 0 0 0 0 rgba(229, 62, 62, 0); }
}

.success-msg {
  font-size: 1.5rem;
  font-weight: 800;
  background: linear-gradient(to right, #f687b3, #b794f4);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  text-align: center;
}

/* =========================================
   CONFETTI
   ========================================= */
.confetti-container {
  position: absolute;
  inset: 0;
  pointer-events: none;
  overflow: hidden;
  z-index: 50;
}

.confetti-piece {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 8px;
  height: 12px;
  background: #ffd700;
  animation: pop 1.5s ease-out forwards;
}

/* Randomize confetti trajectory slightly via nth-child loops would be ideal in SCSS, 
   but for standard CSS we use a generic pop animation and assume React keys help. 
   Ideally, inline styles for random X/Y are better, but this keeps it simple. */

@keyframes pop {
  0% { opacity: 1; transform: translate(-50%, -50%) rotate(0deg); }
  100% { opacity: 0; transform: translate(var(--x, 100px), var(--y, -200px)) rotate(720deg); }
}

/* Specific styling for mobile adjustments */
@media (max-width: 480px) {
  .candle-modal { padding: 16px; }
  .candle-title { font-size: 1.5rem; }
  .action-btn { padding: 12px 24px; font-size: 1rem; }
}